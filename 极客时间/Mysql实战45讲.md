### 01 | 基础架构：一条SQL查询语句是如何执行的？

![](https://github.com/hjy30312/picBed/blob/master/img/1.jpg?raw=true)

​																MySQL的逻辑架构图

大体来说，MySQL可以分为Server层和存储引擎层两部分。

Server层包括连接器、查询缓存、分析器、优化器、执行器等，涵盖 MySQL 的大多数核心服务功能。

存储引擎层负责数据的存储和提取。其架构模式是插件式的，支持InnoDB、MyISAM等多个存储引擎。

#### 连接器 

​	第一步，先连接到这个数据库上，这时候接待的就是连接器。连接器负责跟客户端建立连接、获取权限、维持和管理连接。`mysql - h$ip -P$port -u$user -p$password`

#### 查询缓存

​	第二步，查询缓存。MySQL拿到一个查询请求后，会先到查询缓存看看，之前是否执行过这条语句。之前执行过的语句及其结果可能会以key-value对的形式，被直接缓存在内存中。key是查询的语句，value是查询的结果。如果有缓存，则直接返回value，没有则执行完成后，执行结果存入查询缓存中。

##### 	但是大多数情况下不要使用查询缓存，往往弊大于利（8.0已删除查询缓存[官方说明]( https://mysqlserverteam.com/mysql-8-0-retiring-support-for-the-query-cache/ ))

	1.  查询缓存的失效非常频繁，只要有对一个表的更新，这个表上所有的查询缓存都会被清空。
 	2.   对于面向用户的系统，降低性能的差异通常比提高峰值吞吐量更为重要。

#### 分析器

​	对SQL语句做解析。先会做“词法分析”，需要识别出里面的字符串分别是什么，代表什么。   其次“语法分析”，语法分析器会个根据语法规则，判断你输入的这个SQL语句是否满足MySQL语法。

#### 优化器

​	优化器是在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多表有多表关联(join)的时候，决定各个表的连接顺序。

#### 执行器

	1. 先判断对表是否有查询权限。
 	2. 根据表的引擎定义，去使用这个引擎提供的接口

#### 









